---
apiVersion: cilium.io/v2alpha1
kind: CiliumLoadBalancerIPPool
metadata:
  name: default
spec:
  blocks:
    - cidr: 192.168.40.0/24
---
apiVersion: cilium.io/v2alpha1
kind: CiliumBGPPeeringPolicy
metadata:
  name: peering-policy
spec:
  virtualRouters:
    - localASN: 65444
      serviceSelector:
        matchExpressions:
          - { key: somekey, operator: NotIn, values: ["never-used-value"] }
      neighbors:
        - peerAddress: "192.168.60.1/32"
          peerASN: 65401
          eBGPMultihopTTL: 10
          connectRetryTimeSeconds: 120
          holdTimeSeconds: 90
          keepAliveTimeSeconds: 30
          gracefulRestart:
            enabled: true
            restartTimeSeconds: 120
# ---
# apiVersion: cilium.io/v2alpha1
# kind: CiliumBGPClusterConfig
# metadata:
#   name: cilium-bgp
# spec:
#   nodeSelector:
#     matchLabels:
#       kubernetes.io/os: "linux"
#   bgpInstances:
#     - name: cluster
#       localASN: 65444
#       peers:
#         - name: opnsense
#           peerASN: 65401
#           peerAddress: 192.168.60.1
#           peerConfigRef:
#             name: cilium-peer
# ---
# apiVersion: cilium.io/v2alpha1
# kind: CiliumBGPAdvertisement
# metadata:
#   name: bgp-advertisements
#   labels:
#     advertise: bgp
# spec:
#   advertisements:
#     - advertisementType: "Service"
#       service:
#         addresses:
#           - ExternalIP
#           - LoadBalancerIP
#       selector:
#         matchExpressions:
#           - { key: somekey, operator: NotIn, values: ["never-used-value"] }
